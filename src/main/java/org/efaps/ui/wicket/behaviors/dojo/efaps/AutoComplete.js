define("efaps/AutoComplete",["dojo/_base/declare","dojo/_base/lang","dojo/string","dojo/when","dijit/form/FilteringSelect","dojo/dom-style","dojo/dom-form"],function(e,t,n,r,i,s,o){return e("efaps.AutoComplete",[i],{baseClass:"dijitTextBox dijitComboBox eFapsAutoComplete",callbackUrl:"",minInputLength:1,paramName:"p",indicatorId:"eFapsVeil",extraParameters:[],searchDelay:500,_setBlurValue:function(){var e=this.get("displayedValue");if(e.length==0){this.valueNode.value=""}var t=this.dropDown;if(t&&(e==t._messages["previousMessage"]||e==t._messages["nextMessage"])){this._setValueAttr(this._lastValueReported,true)}else if(typeof this.item=="undefined"){this.item=null;this.set("displayedValue",e)}else{if(this.value!=this._lastValueReported){this._handleOnChange(this.value,true)}this._refreshState()}this.focusNode.removeAttribute("aria-activedescendant")},_startSearch:function(e){if(e.length>=this.minInputLength){s.set(this.indicatorId,"display","");if(!this.dropDown){var n=this.id+"_popup",i=t.isString(this.dropDownClass)?t.getObject(this.dropDownClass,false):this.dropDownClass;this.dropDown=new i({onChange:t.hitch(this,this._selectOption),id:n,dir:this.dir,textDir:this.textDir})}this.inherited(arguments);this._abortQuery();var u=this,a=t.clone(this.query),f={start:0,count:this.pageSize,callbackUrl:this.callbackUrl,paramName:this.paramName,ep:{}},l=e,c;if(this.extraParameters.length>0){var h=o.toObject(this.valueNode.form);for(var p=0;p<this.extraParameters.length;p++){var d=t.getObject(this.extraParameters[p],false,h);if(d!=null){f.ep[this.extraParameters[p]]=d}}}var v=function(){var e=u._fetchHandle=u.store.query(a,f);if(u.disabled||u.readOnly||c!==u._lastQuery){return}r(e,function(t){u._fetchHandle=null;if(!u.disabled&&!u.readOnly&&c===u._lastQuery){r(e.total,function(e){t.total=e;var n=u.pageSize;if(isNaN(n)||n>t.total){n=t.total}t.nextPage=function(e){f.direction=e=e!==false;f.count=n;if(e){f.start+=t.length;if(f.start>=t.total){f.count=0}}else{f.start-=n;if(f.start<0){f.count=Math.max(n+f.start,0);f.start=0}}if(f.count<=0){t.length=0;u.onSearch(t,a,f)}else{v()}};u.onSearch(t,a,f);s.set(u.indicatorId,"display","none")})}},function(e){u._fetchHandle=null;s.set(u.indicatorId,"display","none");if(!u._cancelingQuery){console.error(u.declaredClass+" "+e.toString())}})};t.mixin(f,this.fetchProperties);if(this.store._oldAPI){c=l}else{c=this._patternToRegExp(l);c.toString=function(){return l}}this._lastQuery=a[this.searchAttr]=c;this._queryDeferHandle=this.defer(v,this.searchDelay)}},constructor:function(t){e.safeMixin(this,t)}})})
